<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Drop Service</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- SVG Icons (hidden) -->
  <svg xmlns="http://www.w3.org/2000/svg" class="icons-sprite" aria-hidden="true">
    <defs>
      <symbol id="icon-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></symbol>
      <symbol id="icon-list" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></symbol>
      <symbol id="icon-wallet" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/><path d="M17 14h.01"/></symbol>
      <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
      <symbol id="icon-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></symbol>
      <symbol id="icon-download" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></symbol>
      <symbol id="icon-upload" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></symbol>
      <symbol id="icon-globe" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></symbol>
      <symbol id="icon-bank" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="21" x2="21" y2="21"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="6" y1="6" x2="6" y2="10"/><line x1="10" y1="6" x2="10" y2="10"/><line x1="14" y1="6" x2="14" y2="10"/><line x1="18" y1="6" x2="18" y2="10"/><path d="M12 2L2 6l10 4 10-4-10-4z"/></symbol>
      <symbol id="icon-p2p" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></symbol>
      <symbol id="icon-withdraw" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></symbol>
      <symbol id="icon-merchant" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></symbol>
      <symbol id="icon-copy" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></symbol>
      <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></symbol>
      <symbol id="icon-info" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></symbol>
      <symbol id="icon-link" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></symbol>
    </defs>
  </svg>

  <div id="app">
    <!-- Auth -->
    <section id="page-auth" class="page active">
      <div class="auth-card">
        <div class="skeleton skeleton-avatar"></div>
        <h1 class="auth-title">Drop Service</h1>
        <p id="auth-message" class="auth-msg">Проверяем доступ…</p>
        <div id="auth-pending" class="hidden">
          <p class="text-muted">Ваша заявка на рассмотрении. Ожидайте одобрения в боте.</p>
        </div>
        <div id="auth-rejected" class="hidden">
          <p class="text-danger">Доступ отклонён.</p>
        </div>
      </div>
    </section>

    <!-- Главная -->
    <section id="page-dashboard" class="page">
      <header class="screen-header">
        <h1 class="screen-title">Главная</h1>
      </header>
      <div class="screen-content">
        <div class="card balance-card-modern">
          <p class="card-caption">Баланс</p>
          <p id="balance-usd" class="balance-main">— $</p>
          <p id="balance-rub" class="balance-secondary">— ₽</p>
          <p id="dashboard-rate" class="balance-rate">1 $ = — ₽</p>
        </div>
        <div class="action-grid">
          <button type="button" class="action-card" data-action="requisites">
            <svg class="action-icon" width="24" height="24"><use href="#icon-download"/></svg>
            <span>Реквизиты</span>
          </button>
          <button type="button" class="action-card" data-action="p2p">
            <svg class="action-icon" width="24" height="24"><use href="#icon-p2p"/></svg>
            <span>По запросу (P2P)</span>
          </button>
          <button type="button" class="action-card" data-action="send-check">
            <svg class="action-icon" width="24" height="24"><use href="#icon-upload"/></svg>
            <span>Отправить чек</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Реквизиты -->
    <section id="page-requisites" class="page">
      <header class="screen-header with-back" data-back="dashboard">
        <button type="button" class="btn-back" aria-label="Назад">
          <svg width="24" height="24"><use href="#icon-back"/></svg>
        </button>
        <h1 class="screen-title">Реквизиты</h1>
      </header>
      <div class="screen-content">
        <div id="req-step-choose" class="req-step">
          <p class="block-caption">Как получить реквизиты</p>
          <button type="button" class="card-item req-option-card" id="req-by-country-btn">
            <svg class="card-item-icon" width="24" height="24"><use href="#icon-globe"/></svg>
            <span><strong>По странам</strong><br><small class="text-muted">Страна → банк → реквизиты из базы</small></span>
          </button>
          <button type="button" class="card-item req-option-card" id="req-p2p-btn">
            <svg class="card-item-icon" width="24" height="24"><use href="#icon-p2p"/></svg>
            <span><strong>По запросу (P2P)</strong><br><small class="text-muted">Сумма, страна, банк, время → заявка мерчантам</small></span>
          </button>
        </div>
        <div id="req-step-country" class="req-step hidden">
          <p class="block-caption">Страна</p>
          <div id="req-countries" class="card-list"></div>
          <button type="button" class="btn btn-ghost btn-block req-back-to-choose">← К выбору</button>
        </div>
        <div id="req-step-bank" class="req-step hidden">
          <p class="block-caption">Банк</p>
          <div id="req-banks" class="card-list"></div>
          <button type="button" class="btn btn-ghost btn-block req-back-to-country">← К странам</button>
        </div>
        <div id="req-step-detail" class="req-step hidden">
          <div id="req-detail-card" class="requisite-detail card"></div>
          <button type="button" class="btn btn-primary btn-block" id="req-btn-paid">
            <svg class="btn-icon" width="20" height="20"><use href="#icon-upload"/></svg>
            Я оплатил — загрузить чек
          </button>
        </div>
        <div id="req-p2p-form" class="req-step hidden">
          <p class="block-caption">Заявка P2P</p>
          <div class="form-group">
            <label>Страна</label>
            <div id="p2p-countries" class="card-list"></div>
          </div>
          <div class="form-group p2p-bank-wrap">
            <label>Желаемый банк</label>
            <div id="p2p-banks" class="card-list"></div>
            <input type="text" id="p2p-bank-custom" placeholder="Или введите название банка" maxlength="200">
          </div>
          <div class="form-group">
            <label>Сумма, ₽</label>
            <input type="number" id="p2p-amount" placeholder="5000" min="1" step="1">
          </div>
          <div class="form-group">
            <label>Время на оплату, мин</label>
            <input type="number" id="p2p-time" placeholder="20" min="1" max="1440" value="20">
          </div>
          <button type="button" class="btn btn-primary btn-block" id="p2p-submit">Создать заявку</button>
        </div>
      </div>
    </section>

    <!-- Сделки -->
    <section id="page-deals" class="page">
      <header class="screen-header">
        <h1 class="screen-title">Сделки</h1>
      </header>
      <div class="screen-content">
        <p class="block-caption">Мои заявки</p>
        <div id="my-deals-list" class="deal-list"></div>
        <div id="my-deals-empty" class="empty-state hidden">
          <p class="empty-title">Пока заявок нет</p>
          <p class="empty-hint">Создайте заявку: Главная → Реквизиты → По запросу (P2P).</p>
        </div>
        <div id="deal-detail" class="deal-detail hidden"></div>
      </div>
    </section>

    <!-- Загрузка чека -->
    <section id="page-upload-check" class="page">
      <header class="screen-header with-back" data-back="dashboard">
        <button type="button" class="btn-back" aria-label="Назад">
          <svg width="24" height="24"><use href="#icon-back"/></svg>
        </button>
        <h1 class="screen-title">Отправить чек</h1>
      </header>
      <div class="screen-content">
        <div class="upload-zone card" id="upload-zone">
          <input type="file" id="check-file" accept="image/*" class="hidden">
          <svg class="upload-zone-icon" width="48" height="48"><use href="#icon-upload"/></svg>
          <p id="upload-zone-text" class="upload-zone-text">Нажмите или перетащите фото чека</p>
          <div id="check-preview" class="check-preview hidden"></div>
        </div>
        <p class="hint">Скрин или фото перевода</p>
        <button type="button" class="btn btn-primary btn-block hidden" id="upload-submit">Отправить чек</button>
        <button type="button" class="btn btn-ghost btn-block hidden" id="upload-clear">Выбрать другой файл</button>
      </div>
    </section>

    <!-- Кошелёк -->
    <section id="page-wallet" class="page">
      <header class="screen-header">
        <h1 class="screen-title">Кошелёк</h1>
      </header>
      <div class="screen-content">
        <div class="card balance-card-modern">
          <p class="card-caption">Доступно</p>
          <p id="wallet-balance-usd" class="balance-main">— $</p>
          <p id="wallet-balance-rub" class="balance-secondary">— ₽</p>
          <p id="wallet-rate" class="balance-rate">1 $ = — ₽</p>
        </div>
        <button type="button" class="btn btn-primary btn-block" id="wallet-withdraw">
          <svg class="btn-icon" width="20" height="20"><use href="#icon-withdraw"/></svg>
          Вывести средства
        </button>
        <div id="withdraw-form" class="withdraw-form hidden">
          <p class="hint" id="withdraw-available">Доступно: — $</p>
          <div class="form-group">
            <label>Сумма, USD</label>
            <input type="number" id="withdraw-amount" placeholder="10" min="0.01" step="0.01">
          </div>
          <button type="button" class="btn btn-primary btn-block" id="withdraw-submit">Подать заявку</button>
          <button type="button" class="btn btn-ghost btn-block" id="withdraw-cancel">Отмена</button>
        </div>
        <p class="block-caption">История выводов</p>
        <div id="withdrawals-history" class="card withdrawals-list"></div>
      </div>
    </section>

    <!-- Профиль -->
    <section id="page-profile" class="page">
      <header class="screen-header">
        <h1 class="screen-title">Профиль</h1>
      </header>
      <div class="screen-content">
        <p class="block-caption">Начисления</p>
        <div class="profile-stats card">
          <div class="stat-row">
            <span class="stat-label">За все время</span>
            <span id="profile-total-profit" class="stat-value">— $</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">За день</span>
            <span id="profile-day-profit" class="stat-value">— $</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">За неделю</span>
            <span id="profile-week-profit" class="stat-value">— $</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">За месяц</span>
            <span id="profile-month-profit" class="stat-value">— $</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Рекорд</span>
            <span id="profile-record-profit" class="stat-value">— $</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Место в топе</span>
            <span id="profile-rank" class="stat-value">—</span>
          </div>
        </div>
        <button type="button" class="btn btn-outline btn-block" id="profile-become-merchant">
          <svg class="btn-icon" width="20" height="20"><use href="#icon-merchant"/></svg>
          Стать мерчантом
        </button>
        <div class="card profile-info-block">
          <p class="block-caption">Инфо и поддержка</p>
          <p id="profile-about" class="profile-about hint"></p>
          <div id="profile-links" class="profile-links"></div>
        </div>
      </div>
    </section>

    <!-- Заявка на мерчанта -->
    <section id="page-merchant-apply" class="page">
      <header class="screen-header with-back" data-back="profile">
        <button type="button" class="btn-back" aria-label="Назад">
          <svg width="24" height="24"><use href="#icon-back"/></svg>
        </button>
        <h1 class="screen-title">Заявка на мерчанта</h1>
      </header>
      <div class="screen-content">
        <p class="hint block-muted">Объём, банки, страна, опыт, гарантии, время.</p>
        <div class="form-section">
          <div class="form-group">
            <label>Объём</label>
            <input type="text" id="merchant-volume" placeholder="до 100 000 ₽/день" maxlength="500">
          </div>
          <div class="form-group">
            <label>Банки</label>
            <input type="text" id="merchant-banks" placeholder="Сбер, Тинькофф" maxlength="500">
          </div>
          <div class="form-group">
            <label>Страна</label>
            <input type="text" id="merchant-country" placeholder="Россия" maxlength="200">
          </div>
          <div class="form-group">
            <label>Опыт</label>
            <input type="text" id="merchant-experience" placeholder="Кратко" maxlength="500">
          </div>
          <div class="form-group">
            <label>Гарантии</label>
            <input type="text" id="merchant-guarantees" placeholder="Кратко" maxlength="500">
          </div>
          <div class="form-group">
            <label>Время на работу</label>
            <input type="text" id="merchant-time" placeholder="2–3 ч в день" maxlength="300">
          </div>
          <button type="button" class="btn btn-primary btn-block" id="merchant-apply-submit">Отправить заявку</button>
        </div>
      </div>
    </section>

    <!-- Bottom Nav -->
    <nav id="bottom-nav" class="bottom-nav hidden">
      <button type="button" class="nav-item active" data-page="dashboard" aria-label="Главная">
        <svg class="nav-icon" width="24" height="24"><use href="#icon-home"/></svg>
        <span class="nav-label">Главная</span>
      </button>
      <button type="button" class="nav-item" data-page="deals" aria-label="Сделки">
        <svg class="nav-icon" width="24" height="24"><use href="#icon-list"/></svg>
        <span class="nav-label">Сделки</span>
      </button>
      <button type="button" class="nav-item" data-page="wallet" aria-label="Кошелёк">
        <svg class="nav-icon" width="24" height="24"><use href="#icon-wallet"/></svg>
        <span class="nav-label">Кошелёк</span>
      </button>
      <button type="button" class="nav-item" data-page="profile" aria-label="Профиль">
        <svg class="nav-icon" width="24" height="24"><use href="#icon-user"/></svg>
        <span class="nav-label">Профиль</span>
      </button>
    </nav>
  </div>

  <div id="toast-container"></div>

  <div id="success-overlay" class="success-overlay hidden">
    <div class="success-check">
      <svg viewBox="0 0 52 52" class="success-svg">
        <circle class="success-circle-bg" cx="26" cy="26" r="25"/>
        <path class="success-check-path" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
    </div>
    <p id="success-message">Готово</p>
  </div>

  <div id="deal-req-modal" class="modal-overlay hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close="deal-req-modal"></div>
    <div class="modal-card card">
      <p class="block-caption">Реквизиты для оплаты</p>
      <div id="deal-req-modal-body"></div>
      <button type="button" class="btn btn-ghost btn-block modal-close-btn" data-close="deal-req-modal">Назад</button>
    </div>
  </div>

  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
